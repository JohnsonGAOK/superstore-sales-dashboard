# 🎯 给负责网站的 AI 窗口的说明

## 📋 任务目标

在 Vercel 网站中添加 Dashboard 代理，解决 Streamlit Cloud 在国内访问慢的问题。

---

## 🔗 Dashboard 信息

**原始链接**：https://superstore-sales-dashboard-johnson.streamlit.app/  
**嵌入链接**：https://superstore-sales-dashboard-johnson.streamlit.app/?embed=true

---

## 🚀 实现方案（请根据项目类型选择）

### 方案 A：Next.js 13+ (App Router) ⭐ 推荐

**检测方法**：项目中有 `app/` 目录

**实现步骤**：

1. **创建代理路由文件**：`app/dashboard/route.js`

复制以下代码：

```javascript
import { NextResponse } from 'next/server';

export const runtime = 'edge';

export async function GET(request) {
  const url = new URL(request.url);
  const streamlitUrl = 'https://superstore-sales-dashboard-johnson.streamlit.app' + url.search;
  
  try {
    const response = await fetch(streamlitUrl, {
      signal: AbortSignal.timeout(10000),
    });
    
    const data = await response.arrayBuffer();
    
    return new NextResponse(data, {
      status: 200,
      headers: {
        'Content-Type': response.headers.get('Content-Type') || 'text/html',
        'Cache-Control': 'public, s-maxage=60, stale-while-revalidate=300',
      },
    });
  } catch (error) {
    return new NextResponse('Dashboard 暂时不可用', { status: 503 });
  }
}
```

2. **推送并部署**

```bash
git add app/dashboard/route.js
git commit -m "Add dashboard proxy"
git push
```

3. **访问测试**

访问：`https://你的域名.com/dashboard?embed=true`

---

### 方案 B：Next.js 12 (Pages Router)

**检测方法**：项目中有 `pages/` 目录

**实现步骤**：

1. **创建 API 路由**：`pages/api/dashboard.js`

```javascript
export default async function handler(req, res) {
  const { query } = req;
  const queryString = new URLSearchParams(query).toString();
  const streamlitUrl = `https://superstore-sales-dashboard-johnson.streamlit.app${queryString ? '?' + queryString : ''}`;
  
  try {
    const response = await fetch(streamlitUrl, {
      signal: AbortSignal.timeout(10000),
    });
    
    const data = await response.text();
    
    res.setHeader('Content-Type', response.headers.get('Content-Type') || 'text/html');
    res.setHeader('Cache-Control', 'public, s-maxage=60');
    res.status(200).send(data);
  } catch (error) {
    res.status(503).send('Dashboard 暂时不可用');
  }
}

export const config = {
  api: {
    responseLimit: false,
  },
};
```

2. **（可选）创建独立页面**：`pages/dashboard.js`

```javascript
export default function Dashboard() {
  return (
    <iframe
      src="/api/dashboard?embed=true"
      style={{ width: '100%', height: '100vh', border: 'none' }}
    />
  );
}
```

---

### 方案 C：纯静态网站（HTML/React/Vue）

**检测方法**：没有 `app/` 或 `pages/` 目录

**实现步骤**：

1. **创建/修改 `vercel.json`**

```json
{
  "rewrites": [
    {
      "source": "/dashboard/:path*",
      "destination": "https://superstore-sales-dashboard-johnson.streamlit.app/:path*"
    }
  ]
}
```

2. **推送并部署**

```bash
git add vercel.json
git commit -m "Add dashboard proxy"
git push
```

**注意**：此方法可能无法完美支持 WebSocket

---

## 🎨 在网站中嵌入

### 选项 1：iframe 嵌入（任意页面）

```html
<div style="width: 100%; height: 900px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
    <iframe 
        src="/dashboard?embed=true"
        style="width: 100%; height: 100%; border: none;"
        title="Dashboard"
        loading="lazy">
    </iframe>
</div>
```

### 选项 2：React 组件

```jsx
export default function DashboardEmbed() {
  return (
    <div style={{ width: '100%', height: '900px' }}>
      <iframe
        src="/dashboard?embed=true"
        style={{ width: '100%', height: '100%', border: 'none' }}
        title="Dashboard"
      />
    </div>
  );
}
```

### 选项 3：独立页面

直接访问：`https://你的域名.com/dashboard`

---

## ✅ 验证清单

完成后请检查：

- [ ] 能访问 `/dashboard` 路径
- [ ] Dashboard 正常加载（5-10 秒内）
- [ ] 图表交互功能正常
- [ ] 筛选器正常工作
- [ ] 移动端显示正常
- [ ] 不同浏览器测试通过

---

## 🎨 样式建议

根据网站风格，可以调整：

### 高度
```css
height: 900px;  /* 桌面端 */
height: 600px;  /* 移动端 */
```

### 边框和阴影
```css
border-radius: 12px;
box-shadow: 0 8px 32px rgba(0,0,0,0.12);
```

### 响应式
```css
@media (max-width: 768px) {
  .dashboard-container {
    height: 600px !important;
  }
}
```

---

## 🐛 常见问题

### Q: WebSocket 不工作？

**A**: 添加 WebSocket 代理支持

在 `next.config.js` 中添加：

```javascript
module.exports = {
  async rewrites() {
    return [
      {
        source: '/dashboard/_stcore/:path*',
        destination: 'https://superstore-sales-dashboard-johnson.streamlit.app/_stcore/:path*',
      },
    ];
  },
};
```

### Q: 样式显示不正常？

**A**: 添加静态资源代理

```javascript
{
  source: '/dashboard/static/:path*',
  destination: 'https://superstore-sales-dashboard-johnson.streamlit.app/static/:path*',
}
```

### Q: 超时错误？

**A**: 增加超时时间或使用 Edge Runtime

```javascript
export const runtime = 'edge';
```

---

## 📊 预期效果

| 项目 | 改进前 | 改进后 |
|-----|-------|-------|
| 加载速度 | 10-30秒 | 2-5秒 |
| 稳定性 | ⚠️ 不稳定 | ✅ 稳定 |
| 国内访问 | 😰 困难 | 😊 流畅 |

---

## 💡 优化建议

### 1. 添加加载动画

```html
<div style="position: relative;">
  <div id="loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
    加载中...
  </div>
  <iframe 
    src="/dashboard?embed=true"
    onload="document.getElementById('loading').style.display='none'">
  </iframe>
</div>
```

### 2. 预连接

```html
<link rel="preconnect" href="https://你的域名.com">
```

### 3. 懒加载

```html
<iframe loading="lazy" src="/dashboard?embed=true"></iframe>
```

---

## 🎉 完成

代理配置完成后：

1. ✅ Dashboard 通过你的域名访问
2. ✅ 国内用户访问速度大幅提升
3. ✅ 所有更新自动同步（无需改网站代码）
4. ✅ 完全免费（Vercel 免费额度足够用）

**后续更新**：只需在 Streamlit 项目中更新代码，网站自动同步！

---

## 📞 参考文件

项目中包含以下参考文件（在 `vercel-integration/` 目录）：

- `app-router-route.js` - App Router 完整代码
- `pages-router-api.js` - Pages Router 完整代码
- `next.config.js` - Next.js 配置示例
- `vercel.json` - 静态网站配置
- `vercel_proxy_guide.md` - 详细指南

根据项目类型选择合适的文件即可！

